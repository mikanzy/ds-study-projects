# Прогнозирование заказов такси

## Описание

Построена ML модель для предсказания количества заказов такси в аэропортах на следующий час.


## Данные

Исторические данные о количестве заказов такси в аэропортах.


## Цель проекта

Построить модель для предсказания количества заказов такси на следующий час. 


## Задачи проекта

1. Загрузить данные и выполнить их ресемплирование по одному часу.

2. Проанализировать данные. Определить подходящие прогнозирующие признаки для обучения моделей.

3. Обучить разные модели с различными гиперпараметрами. Выбрать лучшую прогнозную модель.

4. Проверить качество лучшей модели на тестовой выборке размером 10% от исходных данных.


## Используемые библиотеки
*lightgbm, matplotlib, numpy, pandas, scikit-learn, seaborn, shap, statsmodels*

## Основные результаты

1. **Анализ** временного ряда показал:
    - Исследуемый временной ряд — **нестационарный**.  У временного ряда имеется **нарастающий тренд** — рост со временем среднего значения. Стандартное отклонение значений ряда тоже возрастает со временем.
    - Выявлены **сезонные компоненты** временного ряда с периодом 1 сутки (24 часа) и 1 неделя (168 часов). Исследование сезонности помогло выбрать оптимальный период усреднения для расчёта скользящего среднего — 1 неделю как максимальный период сезонности временного ряда.
    - Исследование **частичной автокорреляции** временного ряда помогло выбрать наиболее релевантные запаздывающие признаки для прогнозирования будущих значений ряда, которые сильнее всего коррелируют с текущим значением ряда.

2. Выполнена **подготовка данных**. Введены прогнозирующие признаки, по которым ML модель будет предсказывать значения временного ряда:
    - календарные признаки: день недели и час, которые позволят учесть выявленную суточную и недельную сезонность временного ряда. 
    - скользящее среднее значение количества заказов в час за период предшествующих 7 суток (168 часов), которое позволит учесть тренд временного ряда.
    - запаздывающие признаки — значения количества заказов в час с лагом 1 час, 22 и 23 часа, 1 сутки (24 часа), 2 суток (48 часов) и 1 неделя (168 часов).

3. **Построена и обучена ML модель**, которая предсказывает количество заказов такси на следующий час. Из-за нестационарности временного ряда реальное качество прогнозирующей модели оказалось невозможно объективно установить путём предварительной проверки на валидационной выборке.

4. ML модель можно считать **адекватной**, потому что она показала качество выше, чем у всех рассмотренных "наивных" моделей, которые предсказывают значения временного ряда равными его значениям в предшествующие моменты времени или их агрегатам. Однако у "наивной" модели, предсказания которой равны значениям ряда 1 неделю назад, качество оказалось не сильно хуже. Вероятная причина этого в наличии сильной недельной сезонности в данных.

5. **Анализ ML модели** показал:
    - Модель плохо предсказывает редкие большие значения количества заказов такси за час. 
    - Наиболее значимый для модели признак — количество заказов такси в это же время неделю назад. Значимость скользящего среднего количества заказов за сутки тоже значительна, но влияние сезонности и случайных флуктуаций оказываются сильнее, чем общий тренд.


## Заключение

- Построенная ML модель обеспечивает точность прогноза количества заказов такси в час лучше заданного уровня: значение метрики RMSE (среднеквадратичная ошибка прогноза) на тестовой выборке меньше 48.

- При использовании построенной ML модели точность предсказания количества заказов такси в час возросла по сравнению с "наивным" прогнозом (значение в это же время неделю назад): значение метрики RMSE (среднеквадратичная ошибка прогноза) на тестовой выборке снизилось на 8.6 %.

- Простая "наивная" прогнозирующая модель, которая предсказывает количества заказов такси в час таким же, как в это же время неделю назад, показала результат не намного хуже построенной ML модели. А делать такой прогноз намного проще и быстрее, поскольку нет нужды в обучении ML модели.

- Для поддержания качества прогнозов ML модели на приемлемом уровне необходимо регулярно обучать её на свежих данных.

- Для лучшего учёта вариаций спроса на такси в выходные и праздничные дни желательно предоставить информацию о локации, для которой нужно сделать прогноз (страна, регион).
