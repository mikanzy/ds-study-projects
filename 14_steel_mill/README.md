# Имитация технологического процесса обработки стали на металлургическом комбинате

## Описание

Разработана ML модель для прогнозирования температуры розлива сплава на этапе обработки стали, которая поможет металлургическому комбинату оптимизировать производственные расходы. На основе полученной в результате имитационного моделирования информации сформулированы рекомендации для снижения потребления электроэнергии.


## Данные

Данные о параметрах процесса обработки стали, полученные из разных источников:

1. Данные об электродах:
    - Номер партии стали стали
    - Время начала нагрева
    - Время окончания нагрева
    - Значение активной мощности
    - Значение реактивной мощности
    
2. Данные о подаче сыпучих материалов (объём):
    - Номер партии стали стали
    - Объём подаваемого материала
    
3. Данные о подаче сыпучих материалов (время):
    - Номер партии стали стали
    - Время подачи материала
    
4. Данные о продувке сплава газом:
    - Номер партии стали стали
    - Объём подаваемого газа
    
5. Результаты измерения температуры:
    - Номер партии стали стали
    - Время замера
    - Значение температуры
    
6. Данные о проволочных материалах (объём):
    - Номер партии стали стали
    - Объём подаваемых проволочных материалов
    
7. Данные о проволочных материалах (время):
    - Номер партии стали стали
    - Время подачи проволочных материалов


## Цель проекта

Разработать модель, которая будет предсказывать температуру розлива сплава, которая достигается в конце процесса обработки, когда химический состав сплава соответствует регламентному после легирования.

Заказчик хочет использовать модель, которая будет предсказывать температуру сплава, для имитации технологического процесса, чтобы разработать мероприятия по снижению потребления электроэнергии и расходов на планово-предупредительный ремонт (ППР).


## Задачи проекта

1. Загрузить исходные данные и провести их первичный осмотр.

2. Провести предобработку и исследовательский анализ каждой таблицы.
    - Обработать пропуски, дубликаты и аномалии. Проверить корректность и согласованность данных в таблицах.
    - Выделить из исходных данных признаки, которые будут использоваться для обучения ML моделей: целевой признак и прогнозирующие признаки (предикторы).

3. Объединить таблицы с выделенными из исходных данных признаками в одну таблицу по ключу — номеру партии стали. Добавить в данные новые признаки. 

4. Провести исследовательский анализ объединённой таблицы.
    - Анализ статистических характеристик и визуализация распределений признаков.
    - Анализ корреляций прогнозирующих признаков между собой и с целевым признаком.
    - Проверить, не сгруппированы ли объекты в кластеры по совокупности прогнозирующих признаков.

5. Подготовить данные для обучения моделей. 
    - Разделить данные на обучающую и тестовую выборки.
    - При необходимости преобразовать данные с учётом особенностей конкретных моделей.

6. Обучить несколько ML моделей различных типов, с помощью кросс-валидации на обучающей выборке подобрать для них оптимальные значения гиперпараметров, обеспечивающие минимальное значение метрики MAE.

7. Из обученных моделей выбрать лучшую и проверить её качество на тестовой выборке.

8. Провести анализ выбранной лучшей модели.
    - Проверка на адекватность (сравнение с дамми-моделью).
    - Анализ остатков.
    - Оценка значимости признаков и их влияния на предсказания модели.

9. Составить отчёт о проделанной работе.

10. Дать рекомендации для бизнеса с учётом назначения модели.


## Используемые библиотеки
*catboost, lightgbm, matplotlib, numpy, optuna, pandas, scikit-learn, seaborn, shap, statsmodels*


## Основные результаты

1.  Исходя из постановки задачи, главная **цель применения ML модели** — не предсказание целевого признака, а получение информации о значимости влияющих факторов.

2. Из данных удалены объекты с **аномальными** значениями признаков, которые могут быть связаны со сбоями и нарушениями технологии в процессе обработки.

3. Выделена **целевая переменная** — температура розлива сплава, а также **влияющие факторы** (прогнозирующие признаки):
    - Энергия нагрева, равная произведению длительности нагрева на активную мощность тока. Реактивная мощность в работе электрического тока не участвует.
    - Объёмы добавленных 15 сыпучих и 9 проволочных присадок.
    - Объём поданного газа в процессе обработки.
    - Начальная температура стали в ковше перед началом обработки.
    - Длительность обработки, которая характеризует уровень тепловых потерь.
        
4.  Добавлены **новые признаки**: суммарный объём сыпучих присадок и суммарный объём проволочных присадок.
    
5. Обнаруженные в результате исследования распределений признаков **выбросы** оставлены в данных, чтобы разрабатываемая модель учитывала и такие случаи. Иначе модель покажет очень хорошее качество на очищенных данных, но при реальном применении её качество упадёт.
        
6. Построена и обучена **ML модель**, предсказывающая температуру розлива сплава в конце этапа обработки.
    - Значение метрики MAE лучшей модели на тестовой выборке составило **6.5**, что удовлетворяет заданному требованию MAE ≤ 6.8. 
    - Анализ лучшей модели показал адекватность, стабильность и устойчивость предсказаний модели. Однако модель завышает предсказания в области более низких температур и занижает в области более высоких.
    
7. Наибольшую ценность для оптимизации технологии обработки стали с целью снижения потребления электроэнергии представляет информация о **значимости признаков** для модели:
    - Наибольшее влияние на предсказания модели оказывают признаки `Начальная температура` и `Энергия нагрева`. Признак `Длительность обработки` тоже является довольно значимым.  Направленность влияния этих признаков  согласуется со здравым смыслом: высокая начальная температура и сильный нагрев повышают конечную температуру сплава, а долгая обработка снижает из-за увеличения теплопотерь в окружающую среду.
    - Применение ML модели для прогнозирования температуры розлива сплава позволяет определить направленность и силу влияния добавления различных присадок на температуру розлива.
   
**Ключевые решения, применённые в работе над проектом:**

- Выделение из исходных данных релевантных прогнозирующих признаков (влияющих факторов) исходя из физики рассматриваемого процесса обработки стали таким образом, чтобы признаки имели понятный физический смысл и их влияние  можно было легко интерпретировать. Выделенные влияющие факторы — начальная температура, энергия нагрева, длительность обработки, объём добавленных материалов — характеризуют параметры процесса теплообмена между сплавом в ковше и окружающей средой. Признаки относятся к объекту моделирования — обрабатываемой партии стали в ковше.

- Удаление из данных только заведомо аномальных объектов и ошибочных значений. Возможные в реальности редкие объекты (выбросы) оставлены в данных, чтобы разрабатываемая модель училась их объяснять. Иначе модель может показать очень хорошее качество на очищенных данных, а при реальном применении её качество упадёт.

- Подготовка данных для обучения моделей в зависимости от их типа. Для линейных моделей требуется предварительное масштабирование количественных признаков, а для основанных на деревьях решений (случайный лес, градиентный бустинг) — нет. При этом масштабирование признаков включено в пайплайн линейной модели, чтобы избежать утечки целевого признака при кросс-валидации.

- Использование коэффициента инфляции дисперсии (VIF) для выявления мультиколлинеарности входных признаков, чтобы отобрать признаки для обучения базовой модели линейной регрессии.

- Применение регуляризации модели линейной регрессии для решения проблемы мультиколлинеарности входных признаков.

- Выбор для обучения потенциально наиболее подходящих для задачи типов ML моделей: линейная регрессия, случайный лес, градиентный бустинг.

- Выбор наиболее эффективных средств автоматизированного подбора оптимальных значений гиперпараметров моделей. При небольшом пространстве вариантов использован полный перебор, а в случае большого количества возможных комбинаций использован поиск методом байесовской оптимизации с помощью средств библиотеки Optuna.

- Выбор лучшей модели по критерию минимальности средней абсолютной ошибки (метрики MAE) при кросс-валидации на обучающей выборке.

- Анализ значимости признаков для модели (силы и направленности их влияния на предсказания модели) на основе значений Шепли с помощью средств библиотеки SHAP.


## Заключение

На базе полученных результатов можно сформулировать следующие **рекомендации** для снижения потребления электроэнергии на этапе обработки стали:
- Уменьшить разброс начальной температуры стали, поступающей на обработку. По имеющимся данным, средняя начальная температура практически совпадает с конечной температурой розлива, которая считается оптимальной для плавки, а средний разброс (стандартное отклонение) начальной температуры в 2 раза выше, чем конечной. Тогда:
    - Снизится расход электроэнергии на нагрев ковша в процессе обработки за счёт уменьшения доли партий стали, поступающих на обработку с температурой ниже оптимальной. 
    - Снизится тепловая нагрузка на облицовочный материал ковша за счёт уменьшения доли партий стали, поступающих на обработку с избыточной температурой. 
    
- Сократить время обработки, насколько это возможно. Тогда: 
    - Снизится расход электроэнергии на дополнительный подогрев ковша для компенсации тепловых потерь. 
    - Снизится расход газа для продувки сплава.

Используя разработанную ML модель для имитации технологического процесса обработки стали, можно подобрать минимальное значение расхода электроэнергии, требуемого для получения оптимальной температуры розлива сплава при заданных параметрах обработки: начальной температуре, длительности обработки, объёму добавляемых присадок и газа для продувки. Полученная в результате имитационного моделирования информация позволит технологам разработать **оптимальную методику обработки**, требующую минимального расхода электроэнергии.
