# Предсказание оттока клиентов оператора связи

## Описание

Разработана ML модель для прогноза оттока клиентов, которая предсказывает, разорвёт ли абонент договор, на основе персональных данных о клиенте, а также информации о тарифе и используемых услугах. Выявлены факторы, определяющие склонность клиентов к оттоку. Построен портрет типичного уходящего клиента, сформулированы вероятные причины оттока клиентов и рекомендации по удержанию уходящих клиентов.


## Данные

Собранные оператором персональные данные о некоторых клиентах оператора связи, информацию об их тарифах и услугах:

1. Информация о договоре:
    - Идентификатор абонента
    - Дата начала действия договора
    - Дата окончания действия договора
    - Тип оплаты: раз в год-два или ежемесячно
    - Электронный расчётный лист
    - Тип платежа
    - Расходы за месяц
    - Общие расходы абонента

2. персональные данные клиента:
    - Идентификатор пользователя
    - Пол
    - Является ли абонент пенсионером
    - Есть ли у абонента супруг или супруга
    - Есть ли у абонента дети

3. информация об интернет-услугах:
    - Идентификатор пользователя
    - Тип подключения
    - Блокировка опасных сайтов
    - Облачное хранилище файлов для резервного копирования данных
    - Антивирус
    - Выделенная линия технической поддержки
    - Стриминговое телевидение
    - Каталог фильмов

4. информация об услугах телефонии:
    - Идентификатор пользователя
    - Подключение телефона к нескольким линиям одновременно

Информация о договорах актуальна на 1 февраля 2020 года.


## Цель проекта

Разработать модель для прогноза оттока клиентов, которая будет предсказывать, разорвёт ли абонент договор, на основе персональных данных о клиенте, а также информации о тарифе и используемых услугах. Тем, кто собирается отказаться от его услуг, оператор связи планирует предлагать промокоды и специальные условия.


## Задачи проекта

1. Загрузить исходные данные и провести их первичный осмотр.

2. Провести предобработку и исследовательский анализ каждой таблицы:
    - Обработать пропуски и дубликаты, преобразовать типы данных при необходимости. Проверить корректность и согласованность данных в таблицах.
    
3. Объединить таблицы по ключу — идентификатору абонента. 

4. Провести предобработку и исследовательский анализ объединённой таблицы:
    - Обработать пропуски и аномалий.
    
5. Сгенерировать признаки: целевой признак и прогнозирующие признаки (предикторы), которые будут использоваться для обучения ML моделей.

6. Провести исследовательский анализ данных:
    - Анализ статистических характеристик и визуализация распределений признаков с разбивкой по значению целевого признака (оттока).
    - Анализ корреляций прогнозирующих признаков между собой и с целевым признаком.
    - Проверить сбалансированности данных по значениям целевого признака (оттока).
    - Составить предварительный портрет типичного ушедшего абонента.
   
7. Подготовить данные для обучения моделей:
    - Выделить прогнозирующие и целевой признаки в отдельные переменные.
    - Разделить данные на обучающую и тестовую выборки. 
    - Преобразовать данные с учётом особенностей конкретных моделей.
    
8. Обучить несколько ML моделей различных типов, с помощью кросс-валидации на обучающей выборке подобрать для них оптимальные значения гиперпараметров, обеспечивающие максимальное значение метрики ROC-AUC.

9. Из обученных моделей выбрать лучшую и провести её анализ:
    - Проверить качество модели на тестовой выборке.
    - Проверить модель на адекватность (сравнение с дамми-моделью).
    - Анализ ошибок модели, расчёт и анализ метрик качества классификации.
    - Оценка значимости признаков и их влияния на предсказания модели.
    
10. Составить отчёт о проделанной работе.

11. Сделать выводы и дать рекомендации для бизнеса с учётом назначения модели.


## Используемые библиотеки
*catboost, matplotlib, numpy, optuna, pandas, phik, scikit-learn, seaborn, shap*


## Основные результаты

1. ML модель должна помочь оператору связи установить причины оттока абонентов и разработать меры для их удержания. Таким образом, помимо предсказания целевого признака ещё одна **цель применения ML модели** — получение информации о значимости влияющих факторов.
    
2. Проведена необходимая **предобработка объединённых данных** — обработаны пропущенные значения.

3. **Сгенерированы признаки**, которые будут использованы для обучения ML моделей:
    - Целевой признак — отток, т.е. прекратил ли абонент действие договора;
    - Дополнительные прогнозирующие признаки: 
        - длительность подписки в днях — срок от даты начала до даты окончания действия договора, либо до текущей даты, если договор продолжает действовать, 
        - месяц начала действия договора, 
        - количество подключённых дополнительных интернет-услуг, 
        - факт смены тарифа.

4. Проведён **исследовательский анализ** распределений признаков и корреляций между ними с целью отбора полезных прогнозирующих признаков для обучения ML моделей.

5. Построена и обучена **ML модель**, прогнозирующая отток клиентов.
    - Значение метрики ROC-AUC выбранной лучшей модели на тестовой выборке составило **0.96**, что удовлетворяет заданному требованию ROC-AUC ≥ 0.85. Таким образом, построенная **модель удовлетворяет требованиям заказчика**. 
    - ML модель смогла верно выявить 77% ушедших абонентов. При этом среди абонентов, которых модель классифицировала в отток, на самом деле ушедшими оказались 82.5%. Таким образом, модель хорошо выявляет отток клиентов, а также не слишком часто делает ложные предсказания оттока. В целом ML модель правильно предсказывает отток для 94% абонентов.
    
6. Наиболее **значимые для ML модели признаки** (в порядке убывания значимости) — длительность подписки (абонентский стаж), месяц начала действия договора, тип оплаты:
    - Абоненты со стажем более 4 лет значительно менее склонны к оттоку. Наверное, это связано с тем, что их всё устраивает, и не они видят смысла менять оператора. При меньшем стаже склонность к оттоку возрастает с увеличением стажа и достигает максимума при стаже около 3 лет. 
    - К оттоку наиболее склонны абоненты, подключившиеся в апреле, мае и декабре. А наименее склонны подключившиеся осенью (с сентября по ноябрь) и в январе. Вероятно, это связано с сезонностью в жизни людей. Например,  начало учебного семестра в университетах как раз приходится на сентябрь и январь. Также возможно, что сезонность связана с проведением маркетинговых акций со скидками в эти месяцы, и отток происходит среди тех, кто подключился со скидкой, а потом нашёл более выгодное предложение у другого оператора.
    - К оттоку более склонны абоненты, заключившие договор на более длительный срок. Причём среди них больше склонны к оттоку абоненты с меньшим стажем. Так, среди заключивших договор сразу на 2 года склонность к оттоку выше у абонентов со стажем менее 2 лет. Получается, что они досрочно разрывают договор с оператором. Возможно, их не устраивает качество оказываемых услуг. 


**Главные проблемы и ключевые решения, применённые в работе над проектом:**

- *Проблема*: Пропущенные значения в данных, которые имелись в исходных данных (неявные пропуски — плейсхолдеры), а также возникли при объединении данных вследствие того, что абоненты некоторыми услугами не пользуются. 

  *Решение*: заполнение пропущенных значений на основе анализа причин их возникновения, при этом не используя для заполнения уже имеющиеся значения категориальных признаков.

- *Проблема*: Выбор релевантных признаков для обучения моделей. 

  *Решение*: Создание новых прогнозирующих признаков исходя из априорных представлений о факторах, которые могут влиять на отток клиентов, в сочетании с последующей проверкой степени их связи с целевым признаком (фактом оттока) путём анализа распределений с разбивкой по значению целевого признака и анализа корреляций. Использование для обучения моделей максимального количества прогнозирующих признаков, за исключением непригодных (даты начала и окончания действия договора), нерелевантных (пол абонента), и сильно коррелированных между собой (факты использования отдельных дополнительных интернет-услуг) чтобы повысить качество предсказаний модели. 

- *Проблема*: Выбор типа ML модели для предсказания оттока клиентов.

  *Решение*: Предсказание оттока — это задача бинарной классификации. В качестве базовой модели классификации выбрана логистическая регрессия. Также рассмотрена более продвинутая модель градиентного бустинга на деревьях решений CatBoost.

- *Проблема*: Подготовка данных для обучения моделей в зависимости от их типа. 

  *Решение*: Для логистической регрессии требуется OHE-кодирование категориальных признаков и масштабирование количественных. При этом подготовка данных включена в пайплайн модели, чтобы избежать утечки целевого признака при кросс-валидации. Для модели CatBoost дополнительная подготовка данных не требуется, тем не менее применено порядковое кодирование значений категориальных признаков для удобства последующего анализа влияния значений признаков на предсказания модели.

- *Проблема*: Выбор наиболее эффективных средств автоматизированного подбора оптимальных значений гиперпараметров моделей. 

  *Решение*: При небольшом пространстве вариантов использован полный перебор, а в случае большого количества возможных комбинаций использован поиск методом байесовской оптимизации с помощью средств библиотеки Optuna.
  
- *Проблема*: Выбор лучшей ML модели.

  *Решение*: Лучшая модель выбрана по критерию максимального значения метрики ROC-AUC при кросс-валидации на обучающей выборке.
  
- *Проблема*: Оценка качества предсказаний ML модели для бизнеса. 

  *Решение*: Анализ ошибок модели на тестовой выборке и интерпретация значений метрик качества классификации, проверка оптимальности заданного порога классификации.

- *Проблема*: Встроенное в модель средство оценки значимости признаков не даёт информации о направленности влияния признаков на предсказания модели. 

  *Решение*: Анализ значимости признаков для модели (силы и направленности их влияния на предсказания модели) на основе значений Шепли с помощью средств библиотеки SHAP.


## Заключение

 На основании исследования влияния значений признаков на предсказания ML модели сформулированы:

- **Портрет уходящего клиента**: Семейный абонент со стажем 2-3 года, начавший пользоваться услугами оператора в апреле-мае, выбравший тип оплаты раз в 2 года и не менявший за всё время тариф, активно пользующийся дополнительными услугами и имеющий высокие ежемесячные расходы.

- **Вероятные причины уходя клиентов**: Неудовлетворённость качеством либо стоимостью дополнительных услуг, оказываемых оператором связи. Влияние сезонности по месяцу подключения на отток может означать, что к оттоку также склонны абоненты, подключившиеся в рамках сезонных маркетинговых акций по привлечению новых абонентов.

- **Рекомендации по удержанию уходящих клиентов**: 
    - Следует повышать удовлетворённость абонентов качеством дополнительных услуг, для этого нужно прежде всего выявить наличие проблем с качеством и доступностью услуг, а также провести оценку их конкурентоспособности в сравнении с другими операторами связи, предоставляющими аналогичные услуги. 
    - При планировании акций по привлечению новых абонентов следует особое внимание уделить повышению их долгосрочной лояльности. 
